#!/usr/bin/env node
var argv=require("minimist")(process.argv.slice(2)),pkg=require("./package.json"),semver=require("semver"),os=require("os"),_=require("underscore"),allowed=["help","version","chrome","firefox","nobrowser","no-browser","log-file"];exports.preprocess=function(o){var e=_.difference(_.chain(argv).omit("_").keys().value(),allowed);if(e.length>0&&(console.log("Unsupported options: "+e+". Run the command with a '--help' to see the options available"),process.exit()),argv.help)console.log("Usage: "+pkg.name+" [options]"),console.log("       where options include:"),console.log(""),console.log("--version                          Application version"),console.log("--help                             Print help"),console.log("--chrome                           Use Google Chrome browser"),console.log("--firefox                          Use Firefox browser"),console.log("--no-browser or --nobrowser        Don't open any browser"),console.log("                                   (should be open as a separate command)"),console.log("--log-file                         Log into file"),console.log("                                   (default HOME/.snmpsniffer/log/server.log,"),console.log("                                   'console' for console)"),process.exit();else if(argv.version)console.log(pkg.name+" v."+pkg.version),process.exit();else{var r=process.version,s=pkg.engines.node;semver.satisfies(r,">="+s)||(console.log("The required node version is at least "+s+"; but your node version is "+r+". Please, update your node version"),process.exit(1))}var l,n,i=os.type();if(argv["no-browser"]||argv.nobrowser)global.BROWSER=null;else{var l,n,i=os.type();"Linux"==i?(l="google-chrome --user-data-dir='' --new-window http://localhost:"+o,n="firefox -new-window http://localhost:"+o):"Windows_NT"==i?(l="chrome.exe --new-window http://localhost:"+o,n="firefox.exe -new-window http://localhost:"+o):"Darwin"==i?(l='open -n "/Applications/Google Chrome.app" --args --js-flags=--stack_trace_limit=-1 --user-data-dir=/tmp/jsleakcheck --new-window http://localhost:'+o,n="open -n /Applications/Firefox.app --args -new-instance http://localhost:"+o):(console.log("Your OS type "+i+" is not supported"),exit(1));var a="";a=argv.chrome?l:argv.firefox?n:l+" || "+n,global.BROWSER=a}return global.LOG_FILE=argv["log-file"]||"server.log",argv._};