#!/usr/bin/env node
!function(t){"use strict";function e(t,r){t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=r)}function r(t,e,r,n,i){if(!(n instanceof s))throw"Invalid tag value.";this.stream=t,this.header=e,this.length=r,this.tag=n,this.sub=i}function s(t){var e=t.get();switch(this.tagClass=e>>6,this.tagConstructed=0!==(32&e),this.tagNumber=31&e,e){case 160:this.command="Get";break;case 161:this.command="GetNext";break;case 162:this.command="Response";break;case 163:this.command="Set";break;case 164:this.command="Trap";break;case 165:this.command="GetBulk";break;case 166:this.command="Inform";break;case 167:this.command="Snmpv2-Trap"}if(31==this.tagNumber){var r=new n;do e=t.get(),r.mulAdd(128,127&e);while(128&e);this.tagNumber=r.simplify()}}var n="undefined"!=typeof module?require("./int10.min.js"):window.Int10,i=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,a=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;e.prototype.get=function(e){if(e===t&&(e=this.pos++),e>=this.enc.length)throw"Requesting byte offset "+e+" on a stream of length "+this.enc.length;return this.enc[e]},e.prototype.hexDigits="0123456789ABCDEF",e.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},e.prototype.hexDump=function(t,e,r){for(var s="",n=t;e>n;++n)if(s+=this.hexByte(this.get(n)),r!==!0)switch(15&n){case 7:s+="  ";break;case 15:s+="\n";break;default:s+=" "}return s},e.prototype.isASCII=function(t,e){for(var r=t;e>r;++r){var s=this.get(r);if(32>s||s>127)return!1}return!0},e.prototype.parseStringISO=function(t,e){for(var r="",s=t;e>s;++s)r+=String.fromCharCode(this.get(s));return r},e.prototype.parseStringUTF=function(t,e){for(var r="",s=t;e>s;){var n=this.get(s++);r+=String.fromCharCode(128>n?n:n>191&&224>n?(31&n)<<6|63&this.get(s++):(15&n)<<12|(63&this.get(s++))<<6|63&this.get(s++))}return r},e.prototype.parseStringBMP=function(t,e){for(var r,s,n="",i=t;e>i;)r=this.get(i++),s=this.get(i++),n+=String.fromCharCode(r<<8|s);return n},e.prototype.parseTime=function(t,e,r){var s=this.parseStringISO(t,e),n=(r?i:a).exec(s);return n?(r&&(n[1]=+n[1],n[1]+=n[1]<70?2e3:1900),s=n[1]+"-"+n[2]+"-"+n[3]+" "+n[4],n[5]&&(s+=":"+n[5],n[6]&&(s+=":"+n[6],n[7]&&(s+="."+n[7]))),n[8]&&(s+=" UTC","Z"!=n[8]&&(s+=n[8],n[9]&&(s+=":"+n[9]))),s):"Unrecognized time: "+s},e.prototype.parseInteger=function(t,e){for(var r,s=this.get(t),i=s>127,a=i?255:0,o="";s==a&&++t<e;)s=this.get(t);if(r=e-t,0===r)return i?-1:0;if(r>4){for(o=s,r<<=3;0==(128&(o^a));)o<<=1,--r;o="("+r+" bit)\n"}i&&(s-=256);for(var u=new n(s),h=t+1;e>h;++h)u.mulAdd(256,this.get(h));return o+u.toString()},e.prototype.parseBitString=function(t,e){for(var r=this.get(t),s=(e-t-1<<3)-r,n="("+s+" bit)\n",i="",a=r,o=e-1;o>t;--o){for(var u=this.get(o),h=a;8>h;++h)i+=u>>h&1?"1":"0";a=0}return n+i},e.prototype.parseOctetString=function(t,e){if(this.isASCII(t,e))return this.parseStringISO(t,e);for(var r="",s=t;e>s;++s)r+=this.hexByte(this.get(s));return r},e.prototype.parseOID=function(t,e){for(var r="",s=new n,i=0,a=t;e>a;++a){var o=this.get(a);if(s.mulAdd(128,127&o),i+=7,!(128&o)){if(""===r){s=s.simplify();var u=80>s?40>s?0:1:2;r=u+"."+(s-40*u)}else r+="."+s.toString();s=new n,i=0}}return i>0&&(r+=".incomplete"),r},r.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:switch(this.tag.tagNumber){case 0:return"IpAddress";case 1:return"Counter32";case 2:return"Gauge32";case 3:return"TimeTicks";case 4:return"Opaque";case 5:return"NsapAddress";case 6:return"Counter64";case 7:return"Uinteger32";default:return"Application_"+this.tag.tagNumber.toString()}case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},r.prototype.content=function(){if(this.tag===t)return null;var e=this.posContent(),r=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+r);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(e)?"false":"true";case 2:return this.stream.parseInteger(e,e+r);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(e,e+r);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+r);case 6:return this.stream.parseOID(e,e+r);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(e,e+r);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(e,e+r);case 30:return this.stream.parseStringBMP(e,e+r);case 23:case 24:return this.stream.parseTime(e,e+r,23==this.tag.tagNumber)}return null},r.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},r.prototype.toPrettyString=function(e){e===t&&(e="");var r=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(r+="+"),r+=this.length,this.tag.tagConstructed?r+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(r+=" (encapsulates)"),r+="\n",null!==this.sub){e+="  ";for(var s=0,n=this.sub.length;n>s;++s)r+=this.sub[s].toPrettyString(e)}return r},r.prototype.posStart=function(){return this.stream.pos},r.prototype.posContent=function(){return this.stream.pos+this.header},r.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},r.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},r.decodeLength=function(t){var e=t.get(),r=127&e;if(r==e)return r;if(r>6)throw"Length over 48 bits not supported at position "+(t.pos-1);if(0===r)return null;e=0;for(var s=0;r>s;++s)e=256*e+t.get();return e},s.prototype.isUniversal=function(){return 0===this.tagClass},s.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},r.decode=function(t){t instanceof e||(t=new e(t,0));var n=new e(t),i=new s(t),a=r.decodeLength(t),o=t.pos,u=o-n.pos,h=null,c=function(){if(h=[],null!==a){for(var e=o+a;t.pos<e;)h[h.length]=r.decode(t);if(t.pos!=e)throw"Content size is not correct for container starting at offset "+o}else try{for(;;){var s=r.decode(t);if(s.tag.isEOC())break;h[h.length]=s}a=o-t.pos}catch(n){throw"Exception while decoding undefined length content: "+n}};if(i.tagConstructed)c();else if(i.isUniversal()&&(3==i.tagNumber||4==i.tagNumber)){3==i.tagNumber&&t.get();try{c();for(var g=0;g<h.length;++g)if(h[g].tag.isEOC())throw"EOC is not supposed to be actual content."}catch(p){h=null}}if(null===h){if(null===a)throw"We can't skip over an invalid tag with undefined length at offset "+o;t.pos=o+Math.abs(a)}return new r(n,u,a,i,h)},"undefined"!=typeof module?module.exports=r:window.ASN1=r}();