#!/bin/sh

prefix=$(which node | sed 's|/bin/.*||')
if [ "x$prefix" = "x" ];then
	echo "Nodejs is not installed"
	exit 1
fi

i=0
cur=""
cd $(dirname $0)
while [ "x$cur" = "x" ] && [ "$cur" != "/" ] && [ $i -lt 5 ] 
do
	cur=$(ls | grep 'server.*js')
	if [ "x$cur" = "x" ];then 
		cd ../
	fi
	i=$((i+1))
done
if [ "x$cur" = "x" ];then
	if [ -z $SNMPSNIFFER_HOME ];then
		sniff=$(ls "$prefix/lib/node_modules" | grep "snmpsniffer")
		if [ "x$sniff" = "x" ];then
			echo "The library is not installed"
			exit 1
		fi
		export SNMPSNIFFER_HOME="$prefix/lib/node_modules/snmpsniffer"
	fi
	cd $SNMPSNIFFER_HOME
fi
help=$(echo $* | grep "\-\-help")
serv=$(ls | grep 'server.min.js')
if [ "x$serv" = "x" ];then
	serv=$(ls | grep 'server.js')
fi
if [ "x$help" = "x" ];then
	gksudo "node $serv $*" -k
else
	node $serv $*
fi

